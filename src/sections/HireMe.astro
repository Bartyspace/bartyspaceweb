---
import RoundedButton from '../components/RoundedButton.astro';
---

<section
  id="kontakt"
  class="bg-indigo-950 pb-20">
  <div class="container mx-auto text-center text-white">
    <h2 class="pb-24 text-3xl font-bold">Kontakt</h2>
    <p class="container md:w-[500px] pb-12 text-lg">
      Zajímá vás moje práce? Neváhejte mě kontaktovat! Ať už potřebujete pomoci s
      projektem nebo máte jakékoli dotazy týkající se toho, na čem pracuji, neváhejte se
      na mě obrátit.
    </p>
    <div class="flex justify-center">
      <div class="w-full sm:w-8/12 md:w-6/12 lg:w-4/12">
        <form
          action="https://formspree.io/f/mgegnngg"
          method="POST"
          class="space-y-6"
          id="contact-form">
          <div>
            <label
              for="name"
              class="mb-3 block font-bold text-white">
              Jméno:
            </label>
            <input
              type="text"
              id="name"
              name="name"
              autocomplete="on"
              placeholder="Zadej jméno"
              class="focus:shadow-outline w-full rounded-lg border border-gray-400 px-4 py-3 text-gray-700 shadow-inner focus:border-gray-500 focus:outline-none"
              required
              aria-label="Name"
            />
          </div>
          <div>
            <label
              for="email"
              class="mb-3 block font-bold text-white">
              Email:
            </label>
            <input
              type="email"
              id="email"
              name="email"
              autocomplete="on"
              placeholder="Zadej email"
              class="focus:shadow-outline w-full rounded-lg border border-gray-400 px-4 py-3 text-gray-700 shadow-inner focus:border-gray-500 focus:outline-none"
              required
              aria-label="Email"
            />
          </div>
          <div>
            <label
              for="message"
              class="mb-3 block font-bold text-white">
              Zpráva:
            </label>
            <textarea
              name="message"
              id="message"
              cols="30"
              rows="6"
              autocomplete="off"
              placeholder="Zpráva"
              aria-label="Message"
              class="focus:shadow-outline h-24 max-h-40 min-h-12 w-full rounded-lg border border-gray-400 px-4 py-3 text-gray-700 shadow-inner focus:border-gray-500 focus:outline-none"
              required></textarea>
          </div>
          <div class="flex items-center justify-center pt-6">
            <RoundedButton
              text="Poslat!"
              type="submit"
            />
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
const contactForm = document.getElementById('contact-form') as HTMLFormElement;
if (contactForm) {
  contactForm.addEventListener('submit', async function(e) {
    e.preventDefault(); // Zabrání přesměrování
    
    const button = document.getElementById('submit-btn') as HTMLButtonElement;
    const buttonText = document.getElementById('btn-text');
    const formData = new FormData(contactForm);
    
    // Nastaví loading stav
    if (button) {
      button.disabled = true;
      button.classList.add('loading');
    }
    if (buttonText) {
      buttonText.textContent = 'Odesílám...';
    }
    
    try {
      // Odešle form přes AJAX
      const response = await fetch(contactForm.action, {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      });
      
      if (response.ok) {
        // Úspěšné odeslání - animace úspěchu
        if (button) {
          button.classList.remove('loading');
          button.classList.add('success');
        }
        if (buttonText) {
          buttonText.textContent = 'Odesláno!';
        }
        
        // Vymaže form
        contactForm.reset();
        
        // Po 3 sekundách vrátí původní stav
        setTimeout(() => {
          if (button) {
            button.disabled = false;
            button.classList.remove('success');
          }
          if (buttonText) {
            buttonText.textContent = 'Poslat!';
          }
        }, 3000);
        
      } else {
        throw new Error('Chyba při odesílání');
      }
      
    } catch (error) {
      // Chyba při odesílání
      if (button) {
        button.classList.remove('loading');
        button.classList.add('error');
      }
      if (buttonText) {
        buttonText.textContent = 'Chyba!';
      }
      
      // Po 3 sekundách vrátí původní stav
      setTimeout(() => {
        if (button) {
          button.disabled = false;
          button.classList.remove('error');
        }
        if (buttonText) {
          buttonText.textContent = 'Poslat!';
        }
      }, 3000);
    }
  });
}
</script>
